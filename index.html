<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login | CineLogin</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #0f0f0f;
      color: white;
      margin: 0;
      padding: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
    }
    .container {
      width: 90%;
      max-width: 360px;
      text-align: center;
    }
    input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: none;
      border-radius: 6px;
    }
    input {
      background: #1e1e1e;
      color: white;
    }
    button {
      background: linear-gradient(to right, #007bff, #e91e63);
      color: white;
      font-weight: bold;
      cursor: pointer;
    }
    .carousel {
      display: flex;
      overflow-x: auto;
      gap: 10px;
      padding: 10px 0;
      justify-content: center;
    }
    .carousel img {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
    }
    .carousel img.selected {
      border: 2px solid white;
    }
  </style>
</head>
<body>
  <div class="container">
    <h2>Login to watch for free</h2>
    <div id="mobile-section">
      <input type="tel" id="mobile" placeholder="Enter mobile number" />
      <button id="next-btn">Next</button>
    </div>

    <div id="password-section" style="display:none;">
      <input type="password" id="password" placeholder="Enter password" />
      <button id="login-btn">Login</button>
    </div>

    <div id="signup-section" style="display:none;">
      <div class="carousel" id="dp-carousel">
        <img src="https://i.imgur.com/0y0y0y0.png" onclick="selectDp(this)">
        <img src="https://i.imgur.com/kT4PlmZ.png" onclick="selectDp(this)">
        <img src="https://i.imgur.com/qkdpN.jpg" onclick="selectDp(this)">
      </div>
      <input type="text" id="name" placeholder="Your Name" />
      <input type="password" id="new-password" placeholder="Set Password" />
      <button id="signup-btn">Sign Up</button>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDvKhzHTcSmj3Z64oePRGP2TeEd_5A4RVU",
      authDomain: "authentication-c6c71.firebaseapp.com",
      projectId: "authentication-c6c71",
      storageBucket: "authentication-c6c71.appspot.com",
      messagingSenderId: "707906547881",
      appId: "1:707906547881:web:55c67cf3e7e867951c39b8",
      measurementId: "G-ZKY9SXX8N8"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let mobileNumber = "";
    let selectedDP = "";

    auth.onAuthStateChanged(user => {
      if (user) {
        window.location.href = "profile.html";
      }
    });

    document.getElementById("next-btn").onclick = () => {
      mobileNumber = document.getElementById("mobile").value.trim();
      if (!mobileNumber.startsWith("+")) mobileNumber = "+91" + mobileNumber;
      const email = mobileNumber + "@demo.com";

      auth.fetchSignInMethodsForEmail(email)
        .then(methods => {
          if (methods.length) {
            document.getElementById("mobile-section").style.display = "none";
            document.getElementById("password-section").style.display = "block";
          } else {
            document.getElementById("mobile-section").style.display = "none";
            document.getElementById("signup-section").style.display = "block";
          }
        });
    };

    document.getElementById("login-btn").onclick = () => {
      const password = document.getElementById("password").value;
      const email = mobileNumber + "@demo.com";
      auth.signInWithEmailAndPassword(email, password)
        .then(() => window.location.href = "https://abc.xyz")
        .catch(() => alert("Incorrect password."));
    };

    document.getElementById("signup-btn").onclick = () => {
      const name = document.getElementById("name").value.trim();
      const password = document.getElementById("new-password").value;
      const email = mobileNumber + "@demo.com";

      if (!selectedDP || !name || !password) {
        return alert("Fill all fields and select a DP");
      }

      auth.createUserWithEmailAndPassword(email, password)
        .then(cred => {
          return db.collection("users").doc(cred.user.uid).set({
            name: name,
            dp: selectedDP,
            mobile: mobileNumber
          });
        })
        .then(() => window.location.href = "https://abc.xyz")
        .catch(console.error);
    };

    function selectDp(img) {
      document.querySelectorAll(".carousel img").forEach(el => el.classList.remove("selected"));
      img.classList.add("selected");
      selectedDP = img.src;
    }
  </script>
</body>
</html>
