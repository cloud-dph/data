<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Edit Profile</title>
  <style>
    body {
      font-family: Arial;
      background: #111;
      color: white;
      text-align: center;
      padding: 30px;
    }
    input, button {
      width: 90%;
      padding: 10px;
      margin: 10px;
      border: none;
      border-radius: 6px;
    }
    input {
      background: #222;
      color: white;
    }
    button {
      background: linear-gradient(to right, #007bff, #e91e63);
      color: white;
      cursor: pointer;
    }
    .carousel img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      margin: 5px;
      cursor: pointer;
      border: 2px solid transparent;
    }
    .carousel img.selected {
      border: 2px solid white;
    }
  </style>
</head>
<body>
  <h2>Edit Profile</h2>
  <div class="carousel">
    <img src="https://i.imgur.com/0y0y0y0.png" onclick="selectDp(this)">
    <img src="https://i.imgur.com/kT4PlmZ.png" onclick="selectDp(this)">
    <img src="https://i.imgur.com/qkdpN.jpg" onclick="selectDp(this)">
  </div>
  <input type="text" id="name" placeholder="Update name" />
  <button onclick="updateProfile()">Save</button>

  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDvKhzHTcSmj3Z64oePRGP2TeEd_5A4RVU",
      authDomain: "authentication-c6c71.firebaseapp.com",
      projectId: "authentication-c6c71",
      storageBucket: "authentication-c6c71.appspot.com",
      messagingSenderId: "707906547881",
      appId: "1:707906547881:web:55c67cf3e7e867951c39b8",
      measurementId: "G-ZKY9SXX8N8"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    let selectedDP = "";

    auth.onAuthStateChanged(user => {
      if (!user) return location.href = "index.html";
      db.collection("users").doc(user.uid).get().then(doc => {
        document.getElementById("name").value = doc.data().name;
        selectedDP = doc.data().dp;
      });
    });

    function selectDp(img) {
      document.querySelectorAll(".carousel img").forEach(el => el.classList.remove("selected"));
      img.classList.add("selected");
      selectedDP = img.src;
    }

    function updateProfile() {
      const name = document.getElementById("name").value;
      const user = auth.currentUser;
      if (!user) return;
      db.collection("users").doc(user.uid).update({ name, dp: selectedDP })
        .then(() => window.location.href = "profile.html");
    }
  </script>
</body>
</html>
